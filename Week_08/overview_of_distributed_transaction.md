#### 分布式事务之总结：   

​      当业务量达到必须要分库分表进行处理时，原本单个数据上的事务，就可能成为跨多个数据库的操作，即分布式事务。

​     分布式事务ACID的要求：

   

```
1. 原子性(Atomicity): 事务中的所有操作，要么都成功，要么都失败。
2. 一致性(Consistency): 事务必须使数据库的数据从一个一致性状态达到另一个一致性状态。
3. 隔离性(Isolation): 一个事务的执行不能被其他事务干扰。
4. 持久性(Durability): 事务成功后，对数据库所得的变更应当持久的保存在数据库中。
```

   

###### 本地事务：

​         不保证整体业务的一致性， 也不保证整体事务的隔离性，对并发性能无影响。 

​         适应于对本地事务或分布式事务要求不高的场景。

######  XA 分布式事务协议：

​        XA是X/Open组织提出的，为一种两阶段提交的实现，强制一致性的事务处理。其机制为由一个TM协调多个资源（RM, 包括数据库、文件系统、消息队列）的访问，从而实现分布式事务的提交或回滚。

​        常见的框架有Atomikos,  JBoss narayana,  及Seata

​        优点： 数据强一致性。

​        缺点：会造成性能严重衰退

​        适用场景：金融、账务等数据关键交易，短交易。

######     BASE 柔性事务：

​          这种事务机制放宽了对事务的强一致性要求，但过程中稍有数据不一致性，但最终一致性。从而提升系统整体的吞吐量。

​         BA: 基本可用(Basiclly Available) 保证分布式事务参与放不一定同时在线。

​         S:   柔性状态(Soft state) ，允许系统状态更新有一定的延时（这个延时客户可以接受)

​         E:    最终一致性(Eventual consistency) ,  事务中的一致性放宽，事务完成后的一致性严格遵守（一般采用消息传递的方式保证系统的最终一致性) 

​           用本地事务的机制+ 其他业务程序方面保证来保证事务的一致性。

​          常见的处理模式有：TCC-手动补偿处理，AT-自动补偿处理，SAGA

```
- ​  TCC: 不依赖于RM对分布式事务的支持，认识通过业务逻辑的分解实现分布式事务，对业务有侵入性。 
- ​  AT：  自动补偿处理： 两阶段提交，自动生成反向SQL.可以实现读已提交。
- ​  SAGA ：没有try阶段，直接提交事务，对回滚操作的设计要求较高。
```



​         缺     点： 实现对业务有侵入性，需要有良好的幂等设计及相应的回滚机制。

​        应用场景： 非交易性、非关键性业务、长交易，如论坛业务等